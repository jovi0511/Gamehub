<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>ä¸€é«”æˆå½¢å°éŠæˆ²ï¼ˆè¿·å®®é­”ç‹é›£ç‰ˆï¼‰</title>
  <style>
    body { font-family: sans-serif; background: #eef; padding: 20px; text-align: center; }
    #menu { margin-bottom: 20px; }
    #menu button { padding: 10px 20px; margin: 0 5px; cursor: pointer; }
    .game { display: none; margin-top: 20px; }
    canvas { border: 1px solid #aaa; display: block; margin: 0 auto; }
    label, select, input, button { font-size: 16px; margin: 0 5px; }
  </style>
</head>
<body>

  <h1>ğŸ® ä¸€é«”æˆå½¢å°éŠæˆ²ï¼ˆè¿·å®®é­”ç‹é›£ç‰ˆï¼‰</h1>
  <div id="menu">
    <button type="button" onclick="showGame('maze')">ğŸŒ€ è¿·å®®</button>
    <button type="button" onclick="showGame('guess')">â“ çŒœæ•¸å­—</button>
    <button type="button" onclick="showGame('flappy')">ğŸ¦ Flappy Bird</button>
  </div>

  <!-- è¿·å®® -->
  <div id="maze" class="game">
    <h2>ğŸŒ€ è¿·å®®éŠæˆ²</h2>
    <label for="mazeDiff">é›£åº¦ï¼š</label>
    <select id="mazeDiff">
      <option value="8">ç°¡å–® (8Ã—8)</option>
      <option value="10" selected>æ™®é€š (10Ã—10)</option>
      <option value="12">å›°é›£ (12Ã—12)</option>
      <option value="16">è¶…é›£ (16Ã—16)</option>
      <option value="100">é­”ç‹é›£ (100Ã—100)</option>
    </select>
    <button type="button" onclick="resetMaze()">ç”Ÿæˆè¿·å®®</button>
    <canvas id="mazeCanvas" width="400" height="400"></canvas>
  </div>

  <!-- çŒœæ•¸å­— -->
  <div id="guess" class="game">
    <h2>â“ çŒœæ•¸å­—</h2>
    <label>ç¯„åœï¼š</label>
    <input id="minInput" type="number" value="1" style="width:60px;">
    <span>ï½</span>
    <input id="maxInput" type="number" value="100" style="width:60px;">
    <button type="button" onclick="setRange()">è¨­å®šç¯„åœ</button>
    <br><br>
    <input id="guessInput" type="number" placeholder="è¼¸å…¥æ•¸å­—">
    <button type="button" onclick="checkGuess()">çŒœï¼</button>
    <p id="guessResult"></p>
  </div>

  <!-- Flappy Bird -->
  <div id="flappy" class="game">
    <h2>ğŸ¦ Flappy Bird</h2>
    <canvas id="flappyCanvas" width="400" height="400"></canvas>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      showGame('maze');
      resetGuess();
      initFlappy();
      flappyLoop();
    });

    function showGame(id) {
      document.querySelectorAll('.game').forEach(g => g.style.display = 'none');
      document.getElementById(id).style.display = 'block';
      if (id === 'maze') resetMaze();
      if (id === 'guess') resetGuess();
      if (id === 'flappy') initFlappy();
    }

    // ===== è¿·å®® =====
    const mCtx = document.getElementById('mazeCanvas').getContext('2d');
    let cols, rows, cell, maze, px, py;

    // æª¢æŸ¥è¿·å®®å¯é€šè¡Œæ€§
    function isSolvable() {
      const visited = Array.from({ length: rows }, () => Array(cols).fill(false));
      const queue = [[0,0]];
      visited[0][0] = true;
      while (queue.length) {
        const [y,x] = queue.shift();
        if (y === rows-1 && x === cols-1) return true;
        [[1,0],[-1,0],[0,1],[0,-1]].forEach(([dy,dx]) => {
          const ny = y+dy, nx = x+dx;
          if (ny>=0 && ny<rows && nx>=0 && nx<cols &&
              !visited[ny][nx] && maze[ny][nx]===0) {
            visited[ny][nx] = true;
            queue.push([ny,nx]);
          }
        });
      }
      return false;
    }

    function resetMaze() {
      cols = rows = parseInt(document.getElementById('mazeDiff').value);
      cell = 400 / cols;
      do {
        maze = Array.from({ length: rows }, () => Array(cols).fill(1));
        for (let y = 0; y < rows; y++) {
          for (let x = 0; x < cols; x++) {
            maze[y][x] = Math.random() < 0.7 ? 0 : 1;
          }
        }
        maze[0][0] = 0;
        maze[rows-1][cols-1] = 0;
      } while (!isSolvable());
      px = py = 0;
      drawMaze();
    }

    function drawMaze() {
      mCtx.clearRect(0,0,400,400);
      for (let y = 0; y < rows; y++) {
        for (let x = 0; x < cols; x++) {
          mCtx.fillStyle = maze[y][x] ? '#000' : '#fff';
          mCtx.fillRect(x*cell, y*cell, cell, cell);
        }
      }
      mCtx.strokeStyle = 'red';
      mCtx.lineWidth = 3;
      mCtx.strokeRect((cols-1)*cell, (rows-1)*cell, cell, cell);
      mCtx.fillStyle = 'red';
      mCtx.fillRect(px*cell, py*cell, cell, cell);
    }

    document.addEventListener('keydown', e => {
      if (document.getElementById('maze').style.display === 'block') {
        let dx=0, dy=0;
        if (e.key==='ArrowUp') dy=-1;
        if (e.key==='ArrowDown') dy=1;
        if (e.key==='ArrowLeft') dx=-1;
        if (e.key==='ArrowRight') dx=1;
        if (maze[py+dy]?.[px+dx]===0) {
          px+=dx; py+=dy; drawMaze();
          if (px===cols-1 && py===rows-1) alert('ğŸ‰ ä½ åˆ°é”å‡ºå£ï¼');
        }
      }
    });

    // ===== çŒœæ•¸å­— =====
    let minVal, maxVal, answer;
    function resetGuess(){
      minVal = parseInt(document.getElementById('minInput').value)||1;
      maxVal = parseInt(document.getElementById('maxInput').value)||100;
      if (maxVal<=minVal) maxVal = minVal+1;
      answer = Math.floor(Math.random()*(maxVal-minVal+1))+minVal;
      document.getElementById('guessResult').textContent = '';
      document.getElementById('guessInput').value = '';
    }
    function setRange(){
      resetGuess();
      alert(`ç¯„åœå·²è¨­å®šï¼š${minVal}ï½${maxVal}`);
    }
    function checkGuess(){
      const v = parseInt(document.getElementById('guessInput').value);
      let msg;
      if (v===answer) msg='ğŸ‰ æ­å–œç­”å°ï¼';
      else if (v<answer) msg='å¤ªå°äº†ï¼';
      else msg='å¤ªå¤§äº†ï¼';
      document.getElementById('guessResult').textContent = msg;
    }

    // ===== Flappy Bird =====
    const fC = document.getElementById('flappyCanvas'),
          fCtx = fC.getContext('2d');
    let fy, fv, pipes, fframe, fScore;
    function initFlappy(){
      fy=150; fv=0; pipes=[]; fframe=0; fScore=0;
    }
    document.addEventListener('keydown', e=>{
      if(document.getElementById('flappy').style.display==='block' && e.key===' '){
        e.preventDefault();
        fv=-6;
      }
    });
    function flappyLoop(){
      if(document.getElementById('flappy').style.display==='block'){
        fv+=0.5; fy+=fv;
        if(fframe%100===0) pipes.push({x:400,h:Math.random()*200+50,passed:false});
        fCtx.clearRect(0,0,400,400);
        fCtx.fillStyle='skyblue'; fCtx.fillRect(0,0,400,400);
        fCtx.fillStyle='yellow'; fCtx.fillRect(100,fy,20,20);
        fCtx.fillStyle='green';
        pipes.forEach(p=>{
          p.x-=2;
          fCtx.fillRect(p.x,0,30,p.h);
          fCtx.fillRect(p.x,p.h+100,30,400);
          if(p.x<120 && p.x+30>100 && (fy<p.h || fy>p.h+100)){
            alert('ğŸ’¥ æ’åˆ°äº†ï¼éŠæˆ²é‡é–‹');
            initFlappy();
          }
          if(!p.passed && p.x+30<100){
            fScore++; p.passed=true;
          }
        });
        fCtx.fillStyle='black';
        fCtx.font='20px sans-serif';
        fCtx.fillText('åˆ†æ•¸: '+fScore,10,25);
        fframe++;
      }
      requestAnimationFrame(flappyLoop);
    }
  </script>

</body>
</html>
